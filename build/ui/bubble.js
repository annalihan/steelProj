steel.d("utils/module/layer",[],function(e,t,n){STK.register("utils.module.layer",function(e){var t=function(e){var t={};return"none"==e.style.display?(e.style.visibility="hidden",e.style.display="",t.w=e.offsetWidth,t.h=e.offsetHeight,e.style.display="none",e.style.visibility="visible"):(t.w=e.offsetWidth,t.h=e.offsetHeight),t},n=function(n,o){o=o||"topleft";var i=null;if("none"==n.style.display?(n.style.visibility="hidden",n.style.display="",i=e.core.dom.position(n),n.style.display="none",n.style.visibility="visible"):i=e.core.dom.position(n),"topleft"!==o){var r=t(n);"topright"===o?i.l=i.l+r.w:"bottomleft"===o?i.t=i.t+r.h:"bottomright"===o&&(i.l=i.l+r.w,i.t=i.t+r.h)}return i};return function(o){var i=e.core.dom.builder(o),r=i.list.outer[0],l=i.list.inner[0],s=e.core.dom.uniqueID(r),u={},d=e.core.evt.custEvent.define(u,"show");e.core.evt.custEvent.define(d,"hide");var a=null;return u.show=function(){return r.style.display="",e.core.evt.custEvent.fire(d,"show"),u},u.hide=function(){return r.style.display="none",e.custEvent.fire(d,"hide"),u},u.getPosition=function(e){return n(r,e)},u.getSize=function(e){return(e||!a)&&(a=t.apply(u,[r])),a},u.html=function(e){return void 0!==e&&(l.innerHTML=e),l.innerHTML},u.text=function(t){return void 0!==text&&(l.innerHTML=e.core.str.encodeHTML(t)),e.core.str.decodeHTML(l.innerHTML)},u.appendChild=function(e){return l.appendChild(e),u},u.getUniqueID=function(){return s},u.getOuter=function(){return r},u.getInner=function(){return l},u.getParentNode=function(){return r.parentNode},u.getDomList=function(){return i.list},u.getDomListByKey=function(e){return i.list[e]},u.getDom=function(e,t){return i.list[e]?i.list[e][t||0]:!1},u.getCascadeDom=function(t,n){return i.list[t]?e.core.dom.cascadeNode(i.list[t][n||0]):!1},u}})}),steel.d("utils/kit/dom/layoutPos",[],function(e,t,n){STK.register("utils.kit.dom.layoutPos",function(e){return function(t,n,o){if(!e.isNode(n))throw"kit.dom.layerOutElement need element as first parameter";if(n===document.body)return!1;if(!n.parentNode)return!1;if("none"===n.style.display)return!1;var i,r,l,s,u,d,a;if(i=e.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},o),r=n,!r)return!1;for(;r!==document.body;){if(r=r.parentNode,"none"===r.style.display)return!1;if(d=e.getStyle(r,"position"),a=r.getAttribute("layout-shell"),"absolute"===d||"fixed"===d)break;if("true"===a&&"relative"===d)break}return r.appendChild(t),l=e.position(n,{parent:r}),s={w:n.offsetWidth,h:n.offsetHeight},u=i.pos.split("-"),"left"===u[0]?t.style.left=l.l+i.offsetX+"px":"right"===u[0]?t.style.left=l.l+s.w+i.offsetX+"px":"center"===u[0]&&(t.style.left=l.l+s.w/2+i.offsetX+"px"),"top"===u[1]?t.style.top=l.t+i.offsetY+"px":"bottom"===u[1]?t.style.top=l.t+s.h+i.offsetY+"px":"middle"===u[1]&&(t.style.top=l.t+s.h/2+i.offsetY+"px"),!0}})}),steel.d("utils/module/bubble",["utils/module/layer","utils/kit/dom/layoutPos"],function(e,t,n){e("utils/module/layer"),e("utils/kit/dom/layoutPos"),STK.register("utils.module.bubble",function(e){return function(t,n){if(!t)throw"module.bubble need template as first parameter";var o,i,r,l,s,u,d;i=e.parseParam({width:null,height:null,parent:document.body},n),r=e.utils.module.layer(t),l=r.getDom("outer"),s=r.getDom("inner"),r.getDomListByKey("close")&&(u=r.getDom("close")),l.style.display="none",d=!1;var a=function(t){if(d)return!0;var n=e.fixEvent(t);e.contains(l,n.target)||r.hide()};return u&&e.addEvent(u,"click",r.hide),e.custEvent.add(r,"show",function(){setTimeout(function(){e.addEvent(document.body,"click",a)},0)}),e.custEvent.add(r,"hide",function(){d=!1,e.removeEvent(document.body,"click",a)}),o=r,o.setPosition=function(e){return l.style.top=e.t+"px",l.style.left=e.l+"px",o},o.setLayout=function(t,n){if(!e.isNode(t))throw"module.bubble.setDown need element as first parameter";return e.utils.kit.dom.layoutPos(l,t,n),o},o.setContent=function(t){return"string"==typeof t?s.innerHTML=t:e.isNode(t)&&s.appendChild(t),o},o.setArrow=function(e){var t;r.getDomListByKey("arrow")&&(t=r.getDom("arrow"),t.className=e.className||"",t.style.cssText=e.style||"")},o.clearContent=function(){for(;s.children.length;)e.removeNode(s.children[0])},o.stopBoxClose=function(){d=!0},o.startBoxClose=function(){d=!1},o.destroy=function(){e.removeEvent(document.body,"click",a),r=null,l=null,s=null,u=null},o}})}),steel.d("ui/bubble",["utils/module/bubble"],function(e,t,n){e("utils/module/bubble"),STK.register("ui.bubble",function(e){var t='<div class="W_layer W_layer_pop" node-type="outer"><div class="content"><div class="W_layer_close"><a class="W_ficon ficon_close S_ficon" href="javascript:void(0);" node-type="close" title="关闭">X</a></div><div node-type="inner"></div><div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_t" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',n=[],o=function(o){var l=e.utils.module.bubble(t,o);return e.custEvent.add(l,"hide",function(){r(l),i(l)}),n.push({bub:l,used:!0}),l},i=function(e){e.clearContent(),document.body.appendChild(e.getOuter())},r=function(e){for(var t=0,o=n.length;o>t;t+=1)if(e===n[t].bub)return void(n[t].used=!1)},l=function(e){for(var t,i=0,r=n.length;r>i;i+=1)if(!n[i].used)return n[i].used=!0,t=n[i].bub;return t=o(e)};return function(t){return l(e.parseParam({},t))}})});