steel.d("utils/kit/dom/parseDOM",[],function(e,t,a){STK.register("utils.kit.dom.parseDOM",function(e){return function(e){for(var t in e)e[t]&&1==e[t].length&&(e[t]=e[t][0]);return e}})}),steel.d("utils/kit/extra/doT",[],function(e,t,a){!function(){"use strict";function e(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function t(e,a,n){return("string"==typeof a?a:a.toString()).replace(e.define||s,function(t,a,i,r){return 0===a.indexOf("def.")&&(a=a.substring(4)),a in n||(":"===i?(e.defineParams&&r.replace(e.defineParams,function(e,t,i){n[a]={arg:t,text:i}}),a in n||(n[a]=r)):new Function("def","def['"+a+"']="+r)(n)),""}).replace(e.use||s,function(a,i){e.useParams&&(i=i.replace(e.useParams,function(e,t,a,i){if(n[a]&&n[a].arg&&i){var r=(a+":"+i).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[r]=n[a].text.replace(new RegExp("(^|[^\\w$])"+n[a].arg+"([^\\w$])","g"),"$1"+i+"$2"),t+"def.__exp['"+r+"']"}}));var r=new Function("def","return "+i)(n);return r?t(e,r,n):r})}function n(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var i,r={version:"1.0.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof a&&a.exports?a.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):(i=function(){return this||(0,eval)("this")}(),i.doT=r),String.prototype.encodeHTML=e();var o={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},s=/$^/;r.template=function(a,i,l){i=i||r.templateSettings;var c,u,d=i.append?o.append:o.split,p=0,m=i.use||i.define?t(i,a,l||{}):a;m=("var out='"+(i.strip?m.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):m).replace(/'|\\/g,"\\$&").replace(i.interpolate||s,function(e,t){return d.start+n(t)+d.end}).replace(i.encode||s,function(e,t){return c=!0,d.start+n(t)+d.endencode}).replace(i.conditional||s,function(e,t,a){return t?a?"';}else if("+n(a)+"){out+='":"';}else{out+='":a?"';if("+n(a)+"){out+='":"';}out+='"}).replace(i.iterate||s,function(e,t,a,i){return t?(p+=1,u=i||"i"+p,t=n(t),"';var arr"+p+"="+t+";if(arr"+p+"){var "+a+","+u+"=-1,l"+p+"=arr"+p+".length-1;while("+u+"<l"+p+"){"+a+"=arr"+p+"["+u+"+=1];out+='"):"';} } out+='"}).replace(i.evaluate||s,function(e,t){return"';"+n(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),c&&i.selfcontained&&(m="String.prototype.encodeHTML=("+e.toString()+"());"+m);try{return new Function(i.varname,m)}catch(f){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+m),f}},r.compile=function(e,t){return r.template(e,null,t)},"undefined"!=typeof STK&&STK.register("utils.kit.extra.doT",function(e){return r})}()}),steel.d("utils/kit/io/cssLoader",[],function(e,t,a){STK.register("utils.kit.io.cssLoader",function(e){var t=$CONFIG.version||"",a="http://img.t.sinajs.cn/t4/";"undefined"!=typeof $CONFIG&&(a=$CONFIG.cssPath||a);var n={};return function(i,r,o,s){s=s||t,o=o||function(){};var l=function(e,t){var a=n[e]||(n[e]={loaded:!1,list:[]});return a.loaded?(t(e),!1):(a.list.push(t),a.list.length>1?!1:!0)},c=function(e){for(var t=n[e].list,a=0;a<t.length;a++)t[a](e);n[e].loaded=!0,delete n[e].list};if(l(i,o)){var u=a+i+"?version="+s,d=e.C("link");d.setAttribute("rel","Stylesheet"),d.setAttribute("type","text/css"),d.setAttribute("charset","utf-8"),d.setAttribute("href",u),document.getElementsByTagName("head")[0].appendChild(d);var p=e.C("div");p.id=r,e.core.util.hideContainer.appendChild(p);var m=3e3,f=function(){return 42==parseInt(e.core.dom.getStyle(p,"height"))?(e.core.util.hideContainer.removeChild(p),void c(i)):void(--m>0?setTimeout(f,10):(e.log(i+"timeout!"),e.core.util.hideContainer.removeChild(p),delete n[i]))};setTimeout(f,50)}}})}),steel.d("ui/cal",["utils/kit/dom/parseDOM","utils/kit/extra/doT","utils/kit/io/cssLoader"],function(e,t,a){window.$CONFIG=window.$CONFIG||{},e("utils/kit/dom/parseDOM"),e("utils/kit/extra/doT"),e("utils/kit/io/cssLoader"),STK.register("ui.cal",function(e){var t={outer:'<div class="layer_calendar"><div class="selector" node-type="selector"></div>\r\n					<div node-type="date"></div>\r\n					<div class="datas_list" style="display:none;" node-type="timer"><div class="times clearfix"><div class="input_area">\r\n					<input num-max="23" maxlength="2" action-type="tinput" class="time_input" action-type="" node-type="hour" type="text" placeholder="09">\r\n					:<input num-max="59" maxlength="2" action-type="tinput" class="time_input" node-type="min" type="text" placeholder="00">\r\n					:<input num-max="59" maxlength="2" action-type="tinput" max="59" min="0" class="time_input" node-type="sec" type="text" placeholder="00"></div>\r\n					<a href="javascript:void(0)" action-type="commit" class="time_btn">确定</a>\r\n					</div></div></div>',year:['<a href="javascript:void(0)" action-type="getDay" action-data="year={{=parseInt(it.year,10) - 2*parseInt(it.len,10)}}" class="W_ficon ficon_arrow_left ">b</a>\r\n					<a href="javascript:void(0)" action-type="getDay" action-data="ani=flipInRight&year={{=parseInt(it.year,10) + 2*parseInt(it.len,10)}}" class="W_ficon ficon_arrow_right ">a</a>\r\n					<span class="quick_select">{{=parseInt(it.year,10) - parseInt(it.len,10)}}-{{=parseInt(it.year,10) + parseInt(it.len,10) - 1}}年</span>','<div class="year_list"><ul class="years">{{~it.list :d:index}}\r\n					<li>{{?d.click}}<a href="javascript:void(0)" action-type="setDay" action-data="ani=bounceIn&year={{=d.year}}">{{?}}{{=d.year}}{{?d.click}}</a>{{?}}</li>\r\n					{{~}}</ul></div>'],month:['<a href="javascript:void(0)" action-type="setDay" action-data="year={{=parseInt(it.year,10)-1}}" class="W_ficon ficon_arrow_left ">b</a>\r\n					<a href="javascript:void(0)" action-type="setDay" action-data="ani=flipInRight&year={{=parseInt(it.year,10)+1}}" class="W_ficon ficon_arrow_right ">a</a>\r\n					<a href="javascript:void(0)" action-type="getDay" action-data="ani=bounceOut&year={{=it.year}}" class="quick_select">{{=it.year}}年</a>','<div class="month_list"><ul class="months">{{~it.list :d:index}}\r\n					<li>{{?d.click}}<a href="javascript:void(0)" action-type="setDay" action-data="ani=bounceIn&year={{=it.year}}&month={{=d.month}}">{{?}}{{=d.month}}月{{?d.click}}</a>{{?}}</li>\r\n					{{~}}</ul></div>'],day:['<a href="javascript:void(0)" action-type="setDay" action-data="year={{=it.year}}&month={{=parseInt(it.month,10)-1}}" class="W_ficon ficon_arrow_left ">b</a>\r\n					<a href="javascript:void(0)" action-type="setDay" action-data="ani=flipInRight&year={{=it.year}}&month={{=parseInt(it.month,10)+1}}" class="W_ficon ficon_arrow_right ">a</a>\r\n					<a href="javascript:void(0)" action-type="getDay" action-data="ani=bounceOut&year={{=it.year}}&month={{=it.month}}" class="quick_select">{{=it.year}}年{{=it.month}}月</a>','<div class="datas_list"><ul class="weeks">\r\n					<li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li><li>日</li>\r\n					</ul><ul class="days">\r\n					{{~it.list :d:index}}\r\n						<li>{{?d.click}}<a href="javascript:void(0)" action-type="choose" action-data="year={{=it.year}}&month={{=it.month}}&day={{=d.day}}">{{?}}{{=d.day}}{{?d.click}}</a>{{?}}</li>\r\n					{{~}}</ul></div>']},a={css:"../t4/appstyle/e_component/css/layer_calendar.css",cssId:"appstyle_e_component_css_layer_calendar",years:6,solarMonth:[31,28,31,30,31,30,31,31,30,31,30,31],format:function(t){if(t&&t.format)return t;t&&/\d+/.test(t)||(t=new Date);var n={};switch(typeof t){case"string":t=e.trim(t),t=t.replace(/(\/|-|:| |&)/g,","),t=t.split(","),n.d=new Date(t[0],t[1]-1<0?0:t[1]-1,t[2]||1,t[3]||0,t[4]||0,t[5]||0);break;case"object":n.d=t;break;case"number":n.d=new Date(t)}return isNaN(n.d.getTime())&&(n.d=new Date),n.getTime=n.d.getTime(),n.year=n.d.getFullYear(),n.month=a.doubles(n.d.getMonth()+1),n.day=a.doubles(n.d.getDate()),n.hour=a.doubles(n.d.getHours()),n.min=a.doubles(n.d.getMinutes()),n.sec=a.doubles(n.d.getSeconds()),n.week=n.d.getDay(),n.date=n.year+"-"+n.month+"-"+n.day,n.times=n.hour+"-"+n.min+"-"+n.sec,n.format=!0,n},doubles:function(e){return e=parseInt(e,10),10>e?"0"+e:e},solarDays:function(e,t){return 2==t?e%4==0&&e%100!=0||e%400==0?29:28:a.solarMonth[t-1]}};return window.format=a.format,function(n,i){var r={},o={DOM:{},val:{},objs:{},DOMFun:{close:function(){o.ui.hide()},getOpt:function(){var t=e.core.evt.fixEvent().target;if("tinput"==t.getAttribute("action-type")){var a={el:t,data:{}};return a.data=e.core.json.queryToJson(t.getAttribute("action-data")||""),a}},focus:function(){var e=o.DOMFun.getOpt();e&&o.DFun.select(e)},blur:function(){var e=o.DOMFun.getOpt();e&&o.DFun.blur(e)}},DFun:{choose:function(e){o.ui.clearCla();var t=e.data,n=a.format(t.year+"-"+t.month+"-"+t.day);return i.section&&o.val.sDay&&!o.val.eDay?(o.val.eDay=n,o.val.sDay.getTime>n.getTime&&(o.val.eDay=o.val.sDay,o.val.sDay=n),o.ui.section(),void(!i.showtimes&&o.ui.finish())):(o.val.sDay=n,o.val.eDay=null,e.el.className="day",void(!i.showtimes&&o.ui.finish()))},setDay:function(e){var t=e.data;t.month&&parseInt(t.month,10)<1&&(t.year=parseInt(t.year,10)-1,t.month=12),t.month&&parseInt(t.month,10)>12&&(t.year=parseInt(t.year,10)+1,t.month=1),t.type="day",!t.month&&(t.type="month"),t.type=t.type||"year",o.ui.show(t)},getDay:function(e){var t=e.data;!t.day&&(t.type="month"),!t.month&&(t.type="year"),o.ui.show(t)},select:function(e){e.el.select();var t={max:parseInt(e.el.getAttribute("num-max"),10)||100,min:parseInt(e.el.getAttribute("num-min"),10)||0};o.cutTime&&clearInterval(o.cutTime),o.cutTime=setInterval(function(){o.logic.autoCut(e.el,t)},200)},blur:function(e){o.cutTime&&clearInterval(o.cutTime);var t={max:parseInt(e.el.getAttribute("num-max"),10)||100,min:parseInt(e.el.getAttribute("num-min"),10)||0,format:a.doubles};o.logic.autoCut(e.el,t)},commit:function(e){o.ui.finish()}},logic:{autoCut:function(e,t){if(!/^[0-9]*$/.test(e.value)){var a=parseInt(e.value);e.value=isNaN(a)?"0":a}parseInt(e.value,10)>t.max&&(e.value=t.max),parseInt(e.value,10)<t.min&&(e.value=t.min),t.format&&(e.value=t.format(e.value))},timeLine:function(){var t={},r=i,s=864e5*parseInt(r.longs);if(s&&!isNaN(s)&&(r.stime=a.format(a.format().date),r.etime=a.format((new Date).getTime()+s)),t.s=a.format(r.stime),t.e=a.format(r.etime),t.s.getTime>t.e.getTime){var l=t.e;t.e=t.s,t.s=l}t.s=a.format(t.s.date),t.e=a.format(t.e.date+" 23:59:59"),o.val.line=t,e.log(n,"timeLine:",t.s.date,t.e.date)},belong:function(e,t,a,n){if(!e)return 1;var i,r=(o.val.sDay,n||o.val.line);return t?a?i=o.logic.compare(e,t,a,r):(e<=r.e.year&&e>=r.s.year&&(i=o.logic.compare(e,t,null,r)),i):(e<=r.e.year&&e>=r.s.year&&(i=1),i)},compare:function(e,t,a,n){var i,r=(o.val.sDay,o.logic.getLine(e,t,a)),s=o.logic.getLine(e,t,a,1),l=o.logic.getLine(n.s.year,n.s.month,a&&n.s.day),c=o.logic.getLine(n.e.year,n.e.month,a&&n.e.day,1);return r>=l&&c>=s&&(i=1),i},getLine:function(e,t,n,i){return i?a.format(e+"-"+t+"-"+(n||a.solarDays(e,t))+" 23:59:59").getTime:a.format(e+"-"+t+"-"+(n||1)+" 00:00:00").getTime},daysArr:function(e,t){for(var n=a.format(e+"-"+t+"-1"),i=a.solarDays(e,t),r=0==n.week?7:n.week,s=r-parseInt(n.day,10)%7,l=[],c=1;s>=c;++c)l.push({day:""});for(var u=(o.val.line,o.logic.belong(n.year,n.month)),c=1;i>=c;++c){var d=null;u&&(d=o.logic.belong(n.year,n.month,c)),l.push({day:(10>c?"0":"")+c,click:d})}return{year:n.year,month:n.month,list:l}},monthArr:function(e){for(var t=[],a=o.logic.belong(e),n=1;13>n;++n){var i=null;a&&(i=o.logic.belong(e,n)),t.push({month:n,click:i})}return t},yearArr:function(e,t){e=parseInt(e,10),isNaN(e)&&(e=(new Date).getFullYear());for(var a=[],n=e-t,i=e+t;i>n;++n){var r=o.logic.belong(n);a.push({year:n,click:r})}return a}},ui:{calendar:function(){if(i.section){var e=(n.value||"").split("~");o.val.sDay=a.format(e[0]||""),o.val.eDay=a.format(e[1]||"")}!i.section&&(o.val.sDay=a.format(n.value||""));var t=o.val.sDay;o.logic.timeLine();var r=t;return r.ani="bounceIn",o.ui.show(r),i.showtimes&&(o.DOM.hour.value=t.hour,o.DOM.min.value=t.min,o.DOM.sec.value="00"),o.ui},clearCla:function(){e.foreach(e.sizzle(".day",o.DOM.date),function(e,t){e.className=""})},section:function(){o.ui.clearCla();var t={s:o.val.sDay,e:o.val.eDay||o.val.sDay};e.foreach(e.sizzle("a[action-data]",o.DOM.date),function(a,n){var i=e.queryToJson(a.getAttribute("action-data")),r=o.logic.belong(i.year,i.month,i.day,t),s=i.month?i.day?"day":"month":"year";r&&(a.className=s)})},layer:function(){return o.cal?o.ui:(o.cal=e.insertHTML(document.body,t.outer,"BeforeEnd"),o.DOM=e.utils.kit.dom.parseDOM(e.builder(o.cal).list),o.ui)},setPos:function(t){var a=e.position(n);return o.cal.style.left=a.l+"px",o.cal.style.top=a.t+n.offsetHeight+"px",o.ui},show:function(n){if(n&&n.year){n.type=n.type||"day";var r={year:n.year},s=n.ani||"flipInLeft";switch(n.type){case"year":r.len=a.years,r.list=o.logic.yearArr(n.year,r.len);break;case"month":r.month=n.month,r.list=o.logic.monthArr(n.year,n.month);break;case"day":r=o.logic.daysArr(n.year,n.month)}var l=e.utils.kit.extra.doT.template(t[n.type][0])(r),c=e.utils.kit.extra.doT.template(t[n.type][1])(r);o.ui.layer().setPos(),o.DOM.selector.innerHTML=l;var u=function(e){o.DOM.date.innerHTML=c,o.ui.section()},d="bounceOut"==s;return!d&&u(),i.showtimes&&e.setStyle(o.DOM.timer,"display",""),o.cal.style.display="",o.ui.ani(o.DOM.date,s,function(){d&&u()}),e.stopEvent(),o.ui}},finish:function(){var t=o.val.sDay.date;return i.showtimes&&(t+=" "+(a.doubles(Number(o.DOM.hour.value))||"00")+":"+(a.doubles(Number(o.DOM.min.value))||"00")+":"+(a.doubles(Number(o.DOM.sec.value))||"00")),!i.section||o.val.eDay?(i.section&&(t=o.val.sDay.date+" ~ "+o.val.eDay.date),n.value=t,o.ui.hide(),e.custEvent.fire(r,"finish",o.val),o.ui):void 0},hide:function(t){return o.cal?(e.removeEvent(document.body,"click",o.DOMFun.close),o.ui.ani(o.cal,"bounceOut",function(){e.removeNode(o.cal)}),window.FrameClient&&FrameClient.diaAutoHide&&FrameClient.diaAutoHide(),o.ui):o.ui},ani:function(t,a,n){e.addClassName(t,"animated "+a);var i=function(r){e.removeClassName(t,"animated "+a),n&&n(),e.removeEvent(t,"webkitAnimationEnd",i)};!o.unSupport&&e.addEvent(t,"webkitAnimationEnd",i),!o.checkSupport&&setTimeout(function(){o.checkSupport=!0,o.unSupport=e.core.dom.hasClassName(t,"animated")?!0:null,o.unSupport&&i()},500),o.unSupport&&i()}},loadCss:function(t){var n=e.C("div");return n.id=a.cssId,e.core.util.hideContainer.appendChild(n),42==parseInt(e.core.dom.getStyle(n,"height"))?void e.core.util.hideContainer.removeChild(n):(e.core.util.hideContainer.removeChild(n),void e.utils.kit.io.cssLoader(a.css,a.cssId))},addEvent:function(t,a,n,i){var r=e.E(t);return null==r?!1:(a=a||"click","function"==(typeof n).toLowerCase()?(r.attachEvent?r.attachEvent("on"+a,n):r.addEventListener?r.addEventListener(a,n,i):r["on"+a]=n,!0):void 0)}},s=function(){if(!e.core.dom.isNode(n))throw"视频图层需要传入外层节点对象"},l=function(){},c=function(){i=i||e.queryToJson(n.getAttribute("cal")||""),o.loadCss(),o.ui.calendar(),e.custEvent.define(r,"finish")},u=function(){o.addEvent(o.cal,e.IE?"focusin":"focus",o.DOMFun.focus,!0),o.addEvent(o.cal,e.IE?"focusout":"blur",o.DOMFun.blur,!0),o.addEvent(o.cal,"click",o.DOMFun.focus),e.addEvent(o.cal,"click",e.stopEvent),e.addEvent(document.body,"click",o.DOMFun.close)},d=function(){o.objs.delegate=e.core.evt.delegatedEvent(o.cal),o.objs.delegate.add("choose","click",o.DFun.choose),o.objs.delegate.add("setDay","click",o.DFun.setDay),o.objs.delegate.add("getDay","click",o.DFun.getDay),o.objs.delegate.add("tinput","click",o.DFun.select),o.objs.delegate.add("commit","click",o.DFun.commit)},p=function(){},m=function(){o&&(e.foreach(o.objs,function(e){e.destroy&&e.destroy()}),o=null)},f=function(){s(),l(),c(),u(),d(),p()};return f(),r.destroy=m,r.temp=t,r}})});