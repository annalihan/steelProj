steel.d("utils/kit/dom/parseDOM",[],function(t,a,e){STK.register("utils.kit.dom.parseDOM",function(t){return function(t){for(var a in t)t[a]&&1==t[a].length&&(t[a]=t[a][0]);return t}})}),steel.d("utils/kit/dom/layoutPos",[],function(t,a,e){STK.register("utils.kit.dom.layoutPos",function(t){return function(a,e,n){if(!t.isNode(e))throw"kit.dom.layerOutElement need element as first parameter";if(e===document.body)return!1;if(!e.parentNode)return!1;if("none"===e.style.display)return!1;var s,d,l,i,r,o,c;if(s=t.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},n),d=e,!d)return!1;for(;d!==document.body;){if(d=d.parentNode,"none"===d.style.display)return!1;if(o=t.getStyle(d,"position"),c=d.getAttribute("layout-shell"),"absolute"===o||"fixed"===o)break;if("true"===c&&"relative"===o)break}return d.appendChild(a),l=t.position(e,{parent:d}),i={w:e.offsetWidth,h:e.offsetHeight},r=s.pos.split("-"),"left"===r[0]?a.style.left=l.l+s.offsetX+"px":"right"===r[0]?a.style.left=l.l+i.w+s.offsetX+"px":"center"===r[0]&&(a.style.left=l.l+i.w/2+s.offsetX+"px"),"top"===r[1]?a.style.top=l.t+s.offsetY+"px":"bottom"===r[1]?a.style.top=l.t+i.h+s.offsetY+"px":"middle"===r[1]&&(a.style.top=l.t+i.h/2+s.offsetY+"px"),!0}})}),steel.d("utils/kit/extra/language",[],function(t,a,e){STK.register("utils.kit.extra.language",function(t){return window.$LANG||(window.$LANG={}),function(a,e){var n=t.core.util.language(a,$LANG);return n=n.replace(/\\}/gi,"}"),e&&(n=t.templet(n,e)),n}})}),steel.d("ui/calendarTemp",[],function(t,a,e){STK.register("ui.calendarTemp",function(t){var a='<#et userlist data><li class="clearfix caldr"><p class="month">${data.year}#L{年}${data.month+1}#L{月}</p><ul class="weeks"><li>#L{日}</li><li>#L{一}</li><li>#L{二}</li><li>#L{三}</li><li>#L{四}</li><li>#L{五}</li><li>#L{六}</li></ul><ul class="days"><#list data.dates as list><li><#if (list != "")><#if (data.hasBound && ((data.year < data.bStart.year) ||(data.year == data.bStart.year && data.month < data.bStart.month) || (data.year == data.bStart.year && data.month == data.bStart.month && list < data.bStart.date) ||(data.year > data.bEnd.year) ||(data.year == data.bEnd.year && data.month > data.bEnd.month) || (data.year == data.bEnd.year && data.month == data.bEnd.month && list > data.bEnd.date)))>${list}<#else><#if (data.sType == 1)><#if ((data.year < data.sStart.year) ||(data.year == data.sStart.year && data.month < data.sStart.month) || (data.year == data.sStart.year && data.month == data.sStart.month && list < data.sStart.date) ||(data.year > data.sEnd.year) ||(data.year == data.sEnd.year && data.month > data.sEnd.month) || (data.year == data.sEnd.year && data.month == data.sEnd.month && list > data.sEnd.date))><a action-type="date" href="#date" onclick="return false;" title="${data.year}-${data.month+1}-${list}" year="${data.year}" month="${data.month+1}" day="${list}" action-data="year=${data.year}&month=${data.month}&date=${list}"><strong>${list}</strong></a><#else><a class="day" action-type="date" href="#date" onclick="return false;" title="${data.year}-${data.month+1}-${list}" year="${data.year}" month="${data.month+1}" day="${list}" action-data="year=${data.year}&month=${data.month}&date=${list}"><strong>${list}</strong></a></#if><#else><a action-type="date" href="#date" onclick="return false;" title="${data.year}-${data.month+1}-${list}" year="${data.year}" month="${data.month+1}" day="${list}" action-data="year=${data.year}&month=${data.month}&date=${list}"><strong>${list}</strong></a></#if></#if></#if></li></#list></ul></li>';return a})}),steel.d("ui/calendar",["utils/kit/dom/parseDOM","ui/calendarTemp"],function(t,a,e){t("utils/kit/dom/parseDOM"),t("ui/calendarTemp"),STK.register("ui.calendar",function(t){return function(a){var e,n=new Date,s=[31,28,31,30,31,30,31,31,30,31,30,31],d=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],l=function(t,a){return 1==a?t%4==0&&t%100!=0||t%400==0?29:28:s[a]};return e={data:t.parseParam({year:n.getFullYear(),month:n.getMonth()+1,availableStart:"",availableEnd:"",selectedStart:"",selectedEnd:"",hasBound:!1,selectedType:0},a),getHtml:function(){var a={};a.year=this.data.year,a.month=this.data.month;var e=l(a.year,a.month);a.dates=d.slice(0,e);for(var n=new Date(a.year,a.month,1),s=n.getDay(),i=0;s>i;i++)a.dates.unshift("");return a.sType=this.data.selectedType,1==a.sType&&(a.sStart={year:this.data.selectedStart.getFullYear(),month:this.data.selectedStart.getMonth(),date:this.data.selectedStart.getDate()},a.sEnd={year:this.data.selectedEnd.getFullYear(),month:this.data.selectedEnd.getMonth(),date:this.data.selectedEnd.getDate()}),a.hasBound=this.data.hasBound,a.hasBound&&(a.bStart={year:this.data.availableStart.getFullYear(),month:this.data.availableStart.getMonth(),date:this.data.availableStart.getDate()},a.bEnd={year:this.data.availableEnd.getFullYear(),month:this.data.availableEnd.getMonth(),date:this.data.availableEnd.getDate()}),t.core.util.easyTemplate(t.ui.calendarTemp,a)}}}})}),steel.d("ui/multiCalendar",["utils/kit/dom/parseDOM","utils/kit/dom/layoutPos","utils/kit/extra/language","ui/calendar"],function(t,a,e){t("utils/kit/dom/parseDOM"),t("utils/kit/dom/layoutPos"),t("utils/kit/extra/language"),t("ui/calendar"),STK.register("ui.multiCalendar",function(t){return function(a){var e,n,s=new Date,d=t.utils.kit.extra.language,l='<div class="horizon_caldr" node-type="multiCalendar" style="top:100px;left:200px;z-index:150"><div class="caldr_content"><ul class="caldr_scroll" style="width:1000px;" node-type="calendarList"></ul><a href="javascript:void(0);" class="W_btn_prev caldr_left" node-type="preBtn"><em class="W_ficon ficon_arrow_left S_ficon ">b</em></a><a href="javascript:void(0);" class="W_btn_next caldr_right" node-type="nextBtn"><em class="W_ficon ficon_arrow_right S_ficon">a</em></a></div><div class="caldr_end"><span class="btn"><a href="javascript:void(0);" class="W_btn_e_02" node-type="submit"><span>#L{确定}</span></a><a href="javascript:void(0);" class="W_btn_e_08" node-type="cancel"><span>#L{取消}</span></a></span><p class="clue" node-type="tip">#L{小提示：目前只能查看'+a.availableStart+"以后的数据}</p></div></div>",i=function(t){if(!t||"string"!=typeof t)return t;var a=t.split(/[-\.]/);if(3!=a.length)return t;var e=parseInt(a[0]),n=parseInt(a[1],10),s=parseInt(a[2],10);return new Date(e,n-1,s)};a.availableStart&&(a.availableStart=i(a.availableStart)),a.availableEnd&&(a.availableEnd=i(a.availableEnd)),a.selectedStart&&(a.selectedStart=i(a.selectedStart)),a.selectedEnd&&(a.selectedEnd=i(a.selectedEnd)),e={DOM:{},instances:[],data:t.parseParam({showDate:s,availableStart:"",availableEnd:"",selectedStart:"",selectedEnd:"",count:2,limitLen:0,source:document.body,callback:function(){}},a),container:null,hasBound:!1,createInstances:function(){e.hasBound=""!=this.data.availableStart.toString()&&""!=this.data.availableEnd.toString();for(var a=0;a<this.data.count;a++){var n=this.data.showDate.getFullYear(),s=this.data.showDate.getMonth()+1-this.data.count+a;this.instances.push(new t.ui.calendar({year:s>=0?n:n-1,month:s>=0?s:12+s,availableStart:this.data.availableStart,availableEnd:this.data.availableEnd,selectedStart:this.data.selectedStart,selectedEnd:this.data.selectedEnd,hasBound:this.hasBound,selectedType:e.data.selectedStart?1:0}))}},showUI:function(){var n=e.getContainer();if(e.container=n,n)t.utils.kit.dom.layoutPos(n,this.data.source,{pos:"left-bottom",offsetX:a&&a.left||-350,offsetY:a&&a.top||0}),this.DOM=t.utils.kit.dom.parseDOM(t.builder(e.container).list),e.refreshUI(),e.container.style.display="block";else{for(var s=t.core.dom.builder(d(l)),i="",r=0;r<this.instances.length;r++)i+=this.instances[r].getHtml();s.list.calendarList[0].innerHTML=d(i),t.utils.kit.dom.layoutPos(s.list.multiCalendar[0],this.data.source,{pos:"left-bottom",offsetX:a&&a.left||-350,offsetY:a&&a.top||0}),e.container=this.getContainer(),this.DOM=t.utils.kit.dom.parseDOM(t.builder(t.sizzle("[node-type=multiCalendar]")[0]).list)}},refreshUI:function(){var t,a,n=e.data.limitLen,s=e.hasBound;if(n)if(s=!0,""!=e.data.selectedStart&&e.data.selectedStart==e.data.selectedEnd){if(t=new Date(e.data.selectedStart.getTime()),a=new Date(e.data.selectedEnd.getTime()),t.setDate(t.getDate()-n),a.setDate(a.getDate()+n),e.hasBound){var l=e.data.availableStart;t=l>t?l:t;var i=e.data.availableEnd;a=a>i?i:a}}else e.hasBound?(t=e.data.availableStart,a=e.data.availableEnd):s=!1;for(var r="",o=0;o<this.instances.length;o++)this.instances[o].data.selectedStart=e.data.selectedStart,this.instances[o].data.selectedEnd=e.data.selectedEnd,this.instances[o].data.selectedType=e.data.selectedStart?1:0,n&&(this.instances[o].data.availableStart=t,this.instances[o].data.availableEnd=a,this.instances[o].data.hasBound=s),r+=this.instances[o].getHtml();e.DOM.calendarList.innerHTML=d(r)},changeSelected:function(t){var a=new Date(t.data.year,t.data.month,t.data.date),n=e.data.selectedStart,s=e.data.selectedEnd;""==n||""==s||n.getFullYear()!=s.getFullYear()||n.getMonth()!=s.getMonth()||n.getDate()!=s.getDate()?e.data.selectedStart=e.data.selectedEnd=a:e.data.selectedStart<a?e.data.selectedEnd=a:e.data.selectedStart=a,e.refreshUI()},showPre:function(){for(var t=0;t<e.instances.length;t++)e.instances[t].data.month--,e.instances[t].data.month<0&&(e.instances[t].data.year--,e.instances[t].data.month=11);e.refreshUI()},showNext:function(){for(var t=0;t<e.instances.length;t++)e.instances[t].data.month++,e.instances[t].data.month>11&&(e.instances[t].data.year++,e.instances[t].data.month=0);e.refreshUI()},submit:function(){var t={};t.startDate=e.data.selectedStart,t.endDate=e.data.selectedEnd,t.startDate&&t.endDate&&(e.data.callback(t),e.close())},close:function(){e.container.style.display="none",n.remove("date","click",e.changeSelected),t.removeEvent(e.DOM.preBtn,"click",e.showPre),t.removeEvent(e.DOM.nextBtn,"click",e.showNext),t.removeEvent(e.DOM.submit,"click",e.submit),t.removeEvent(e.DOM.cancel,"click",e.close),t.removeEvent(document.body,"click",e.clickClose)},clickClose:function(){var a=STK.core.evt.getEvent(),n=e.getContainer();t.core.evt.hitTest(n,a)||e.close()},getContainer:function(){var a=t.core.dom.sizzle('[node-type="multiCalendar"]',document.body);return a=a.length>0?a[0]:null}};var r=function(){n=t.delegatedEvent(t.sizzle("[node-type=multiCalendar]")[0]),n.add("date","click",e.changeSelected),t.addEvent(e.DOM.preBtn,"click",e.showPre),t.addEvent(e.DOM.nextBtn,"click",e.showNext),t.addEvent(e.DOM.submit,"click",e.submit),t.addEvent(e.DOM.cancel,"click",e.close),t.addEvent(document.body,"click",e.clickClose)},o=function(){e.createInstances(),e.showUI(),r()};return o(),e}})});