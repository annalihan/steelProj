steel.d("utils/kit/dom/textSelection",[],function(e,t,n){STK.register("utils.kit.dom.textSelection",function(e){return function(t,n){var r,u;r={},u=e.parseParam({},n);var a=function(n){return e.core.dom.selectText(t,n)},l=function(){t.__areaQuery=e.jsonToQuery(e.core.dom.textSelectArea(t))},o=function(){t.__areaQuery=!1};e.addEvent(t,"beforedeactivate",l),e.addEvent(t,"active",o);var s=function(){var n=null;try{n=e.core.dom.textSelectArea(t)}catch(r){n=e.queryToJson(t.__areaQuery)}return 0===n.start&&0===n.len&&t.__areaQuery&&(n=e.queryToJson(t.__areaQuery)),n.start=parseInt(n.start,10),n.len=parseInt(n.len,10),n},i=function(e,n){var r=t.value,u=n.start,a=n.len||0,l=r.slice(0,u),o=r.slice(u+a,r.length);t.value=l+e+o,r=null,l=null,o=null;var u=null,a=null};return r.setCursor=function(e){a(e)},r.getCursor=function(){return s()},r.insertCursor=function(e){var t=s();i(e,t),t.len=e.length,a(t)},r.TempletCursor=function(n){var r,u,l;r=s(),u=r.len>0?t.value.substr(r.start,r.len):"",l=e.templet(n,{origin:u}),i(l,r),r.start=r.start+n.indexOf("#{origin"),r.len=l.length-n.replace(/#\{[origin].+?\}/,"").length,a(r)},r.insertText=i,r.destroy=function(){e.removeEvent(t,"beforedeactivate",l),e.removeEvent(t,"active",o),t=null},r}})}),steel.d("utils/kit/dom/smartInput",["utils/kit/dom/textSelection"],function(e,t,n){e("utils/kit/dom/textSelection"),STK.register("utils.kit.dom.smartInput",function(e){return function(t,n){var r,u,a,l,o,s,i,c,v,d,f,y,m,p,E="stop";return r=e.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},n),u=e.cascadeNode(t),o=e.utils.kit.dom.textSelection(t),e.custEvent.define(u,"enter"),e.custEvent.define(u,"ctrlEnter"),e.custEvent.define(u,"lazyInput"),a=function(){r.maxLength&&e.bLength(t.value)>r.maxLength&&(t.value=e.leftB(t.value,r.maxLength))},f=function(){t.value===r.notice&&(t.value="",null!=r.noticeClass&&e.removeClassName(t,r.noticeClass)),null!=r.currentClass&&e.addClassName(t.parentNode,r.currentClass)},y=function(){""===t.value&&(t.value=r.notice,null!=r.noticeClass&&e.addClassName(t,r.noticeClass)),null!=r.currentClass&&e.removeClassName(t.parentNode,r.currentClass)},l=function(){return a(),t.value===r.notice?"":t.value},m=function(t){13===t.keyCode&&e.custEvent.fire(u,"enter",l())},p=function(t){13!==t.keyCode&&10!==t.keyCode||!t.ctrlKey||e.custEvent.fire(u,"ctrlEnter",l())},s=function(){"stop"===E&&(v=setInterval(c,r.LazyInputDelay),E="sleep")},i=function(){clearInterval(v),E="stop"},c=function(){d===t.value?"weakup"===E?(e.custEvent.fire(u,"lazyInput",t.value),E="sleep"):"waiting"===E&&(E="weakup"):E="waiting",d=t.value},r.needLazyInput&&(e.addEvent(t,"focus",s),e.addEvent(t,"blur",i)),e.addEvent(t,"focus",f),e.addEvent(t,"blur",y),e.addEvent(t,"keyup",a),e.addEvent(t,"keydown",m),e.addEvent(t,"keydown",p),u.getValue=l,u.setValue=function(e){return t.value=e,a(),u},u.setNotice=function(e){return r.notice=e,u},u.setNoticeClass=function(e){return r.noticeClass=e,u},u.setNoticeStyle=function(e){return r.noticeStyle=e,u},u.setMaxLength=function(e){return r.maxLength=e,u},u.restart=function(){y()},u.startLazyInput=s,u.stopLazyInput=i,u.setCursor=o.setCursor,u.getCursor=o.getCursor,u.insertCursor=o.insertCursor,u.insertText=o.insertText,u.destroy=function(){r.needLazyInput&&(e.removeEvent(t,"focus",f),e.removeEvent(t,"blur",y)),i(),e.removeEvent(t,"focus",f),e.removeEvent(t,"blur",y),e.removeEvent(t,"keyup",a),e.removeEvent(t,"keydown",m),e.removeEvent(t,"keydown",p),e.custEvent.undefine(u,"enter"),e.custEvent.undefine(u,"ctrlEnter"),e.custEvent.undefine(u,"lazyInput"),o.destroy(),u=null},u}})});