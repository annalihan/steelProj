steel.d("utils/kit/extra/htmlparser",[],function(e,t,n){STK.register("core.util.htmlparser",function(e){function t(e){for(var t={},n=e.split(","),a=0;a<n.length;a++)t[n[a]]=!0;return t}var n={},a=/^<(\w+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/(\w+)[^>]*>/,i=/(\w+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,o=t("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),s=t("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),l=t("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),c=t("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),d=t("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),m=t("script,style"),u=n.HTMLParser=function(e,t){function n(e,n,a,r){if(s[n])for(;g.last()&&l[g.last()];)u("",g.last());if(c[n]&&g.last()==n&&u("",n),r=o[n]||!!r,r||g.push(n),t.start){var m=[];a.replace(i,function(e,t){var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:d[t]?t:"";m.push({name:t,value:n,escaped:n.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(n,m,r)}}function u(e,n){if(n)for(var a=g.length-1;a>=0&&g[a]!=n;a--);else var a=0;if(a>=0){for(var r=g.length-1;r>=a;r--)t.end&&t.end(g[r]);g.length=a}}var f,p,h,g=[],b=e;for(g.last=function(){return this[this.length-1]};e;){if(p=!0,g.last()&&m[g.last()])e=e.replace(new RegExp("(.*)</"+g.last()+"[^>]*>"),function(e,n){return n=n.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.chars&&t.chars(n),""}),u("",g.last());else if(0==e.indexOf("<!--")?(f=e.indexOf("-->"),f>=0&&(t.comment&&t.comment(e.substring(4,f)),e=e.substring(f+3),p=!1)):0==e.indexOf("</")?(h=e.match(r),h&&(e=e.substring(h[0].length),h[0].replace(r,u),p=!1)):0==e.indexOf("<")&&(h=e.match(a),h&&(e=e.substring(h[0].length),h[0].replace(a,n),p=!1)),p){f=e.indexOf("<");var v=0>f?e:e.substring(0,f);e=0>f?"":e.substring(f),t.chars&&t.chars(v)}if(e==b)throw"Parse Error: "+e;b=e}u()};return n.HTMLtoXML=function(e){var t="";return u(e,{start:function(e,n,a){t+="<"+e;for(var r=0;r<n.length;r++)t+=" "+n[r].name+'="'+n[r].escaped+'"';t+=(a?"/":"")+">"},end:function(e){t+="</"+e+">"},chars:function(e){t+=e},comment:function(e){t+="<!--"+e+"-->"}}),t},n.HTMLtoDOM=function(e,n){var a=t("html,head,body,title"),r={link:"head",base:"head"};n?n=n.ownerDocument||n.getOwnerDocument&&n.getOwnerDocument()||n:"undefined"!=typeof DOMDocument?n=new DOMDocument:"undefined"!=typeof document&&document.implementation&&document.implementation.createDocument?n=document.implementation.createDocument("","",null):"undefined"!=typeof ActiveX&&(n=new ActiveXObject("Msxml.DOMDocument"));var i=[],o=n.documentElement||n.getDocumentElement&&n.getDocumentElement();if(!o&&n.createElement&&function(){var e=n.createElement("html"),t=n.createElement("head");t.appendChild(n.createElement("title")),e.appendChild(t),e.appendChild(n.createElement("body")),n.appendChild(e)}(),n.getElementsByTagName)for(var s in a)a[s]=n.getElementsByTagName(s)[0];var l=a.body;return u(e,{start:function(e,t,o){if(a[e])return void(l=a[e]);var s=n.createElement(e);for(var c in t)s.setAttribute(t[c].name,t[c].value);r[e]&&"boolean"!=typeof a[r[e]]?a[r[e]].appendChild(s):l&&l.appendChild&&l.appendChild(s),o||(i.push(s),l=s)},end:function(e){i.length-=1,l=i[i.length-1]},chars:function(e){l.appendChild(n.createTextNode(e))},comment:function(e){}}),n},n})});