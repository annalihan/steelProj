steel.d("utils/kit/extra/require",[],function(e,t,r){STK.register("utils.kit.extra.require",function(e){var t=window.$CONFIG||{},r="loaded",n="waiting",i="loading",u={},o={},a=[],s=[],l=!1,f={maxLine:4,maxRetryTimes:1,baseURL:t.jsPath,projectName:"enterprise",version:t.version,timeout:3e4,urlRule:null},c=function(e){for(var t,r={},n=e.length;n--;){if(t=e[n],r[t])return!1;r[t]=1}return!0},d=function(e){var t=/^http[s]?:\/\//gi;return t.test(e)},p=function(t){var r=e.core.arr.indexOf(t,s);return-1!==r?s.splice(r,1):!1},h=function(e){return"function"==typeof f.urlRule?f.urlRule(f.baseURL,e,f.version):(e=e.replace(/\./gi,"/"),f.baseURL+f.projectName+"/js/"+e+".js?version="+f.version)},m=function(t){s.push(t),o[t].state=i;var a=function(){var e,n,i,a=o[t].depeKeys;p(t),o[t].state=r,l&&y();for(var s=a.length;s--;){if(n=a[s],e=u[n],e.unReadyNum-=1,e.unReadyNum)return;for(;u[n].bindFuns.length;)i=e.bindFuns.shift(),i.func.apply({},[].concat(i.data))}},c=function(){var e,r,i,a,s=o[t];if(p(t),s.state=n,s.retry<f.maxRetryTimes)return s.retry+=1,m(t);l&&y(),r=s.depeKeys;for(var c=r.length;c--;)for(i=r[c],e=u[i];e.timeoutFuns.length;)a=e.timeoutFuns.shift(),a.call({},i)};e.core.io.scriptLoader({url:d(t)?t:h(t),timeout:f.timeout,onComplete:a,onTimeout:c})},g=function(t,r,i,a){var s=u[t];if(s||e.log("[STK.kit.extra.require]: The depend "+t+" is undefined!"),!s.unReadyNum)return e.log("依赖关系已加载完成："+t),r.apply({},[].concat(i));s.bindFuns.push({func:r,data:i}),a&&"function"==typeof a.onTimeout&&s.timeoutFuns.push(a.onTimeout);for(var l=s.urlList.length;l--;)aUrl=s.urlList[l],o[aUrl].state===n&&(o[aUrl].retry=0,m(aUrl))},v=function(t,i,s){void 0!==u[t]&&e.log("[STK.kit.extra.require]: "+t+" has been registered!"),c(i)||e.log("[STK.kit.extra.require]: The depend URLs is not unique! The depes is ["+i+"]");var l,f=0;s=e.parseParam({activeLoad:!1},s||{});for(var d=i.length;d--;)l=i[d],o[l]?(o[l].depeKeys.push(t),o[l].state===r&&(f+=1)):(o[l]={depeKeys:[t],state:n,retry:0},s.activeLoad&&a.push(l));return u[t]={urlList:i,bindFuns:[],timeoutFuns:[],unReadyNum:i.length-f},u[t]},y=function(){if(!a.length)return void(l=!1);l=!0;for(var e,t=f.maxLine-1-s.length;t>0&&a.length;)e=a.shift(),o[e].state===n&&(m(e),t-=1)},T=function(t){f=e.core.json.merge(f,t)},L=function(e,t,r){if("function"!=typeof t)throw'[STK.kit.extra.require]: The "func" musts be a Function!';return function(n){g(e,t,[].slice.call(arguments),r)}};return g.bind=L,g.config=T,g.register=v,g.activeLoad=y,g})});