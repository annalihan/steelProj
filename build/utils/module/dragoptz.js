steel.d("utils/kit/dom/parseDOM",[],function(e,t,o){STK.register("utils.kit.dom.parseDOM",function(e){return function(e){for(var t in e)e[t]&&1==e[t].length&&(e[t]=e[t][0]);return e}})}),steel.d("utils/kit/dom/firstChild",[],function(e,t,o){STK.register("utils.kit.dom.firstChild",function(e){var t=e.core.dom.next;return function(e){var o=e.firstChild;return o&&1!=o.nodeType&&(o=t(o)),o}})}),steel.d("utils/kit/dom/parentElementBy",[],function(e,t,o){STK.register("utils.kit.dom.parentElementBy",function(e){return function(e,t,o){if(!e||!t)throw new Error("传入的参数为空");var n,r=0;for(e=e.parentNode;e.parentNode;){if(r++,n=o(e),n===!1)return!1;if(n===!0)return e;if(n===t)return null;if(e=e.parentNode,r>3e4)return!1}return null}})}),steel.d("utils/module/dragoptz",["utils/kit/dom/parseDOM","utils/kit/dom/firstChild","utils/kit/dom/parentElementBy"],function(e,t,o){e("utils/kit/dom/parseDOM"),e("utils/kit/dom/firstChild"),e("utils/kit/dom/parentElementBy"),STK.register("utils.module.dragoptz",function(e){e.utils.kit.extra.language;return function(t,o){var n,r,d,a,i,l,g,s,u,c={};o.spaceTag=o.spaceTag?o.spaceTag:"div",o.containment=o.containment?o.containment:!1,o.hasSpecialElType=o.hasSpecialElType||!1,o.dragIconActionType=o.dragIconActionType||null;var m=!0,f={DOM:{},objs:{},DOM_eventFun:{},DeventFun:{drag:function(n){t.style.position="relative";var r=e.core.evt.getEvent();o.dragNode&&!n.el.dragDom&&(n.el.dragDom=e.utils.kit.dom.parentElementBy(n.el,t,function(e){return e.getAttribute("drag-node")?!0:void 0})),f.dragObj={dom:n.el,el:n.el.dragDom||n.el,target:r.target||e.core.evt.fixEvent().target},f.dragFun.start(r)},controlOver:function(e){m=!1},controlOut:function(e){m=!0}},land:function(e){return o.land=e?1:2,c},demo:function(e){return o.demo=!0,e?(1==e.type&&(o.dragSelf=!0),e.start&&"function"==typeof e.start&&(o.demoStart=e.start),e.move&&"function"==typeof e.move&&(o.demoMove=e.move),e.end&&"function"==typeof e.end&&(o.demoEnd=e.end),c):void 0},scroll:function(t){return t?(o.outer=e.core.dom.isNode(t)?[t]:t,e.core.arr.foreach(o.outer,function(e,t){var o=e.style.height;e.style.height="auto",e.h=e.offsetHeight,e.style.height=o}),c):void 0},dragFun:{start:function(t){return m?void 0:(document.body.style.cursor="move",document.body.onselectstart=function(){return!1},e.addEvent(document,"mousemove",f.dragFun.draging),e.addEvent(document,"mouseup",f.dragFun.end),e.addEvent(document,"click",f.dragFun.stopClick,!0),e.IE||(t.preventDefault(),t.stopPropagation()),!1)},go:function(n){f.actDOM=o.dragNode?e.sizzle("[drag-node=true]",t):e.sizzle("[action-type="+o.actType+"]",t);var r=f.dragFun.pos(n,f.dragObj);e.custEvent.fire(c,"dragStart",r),o.demo&&f.demoFun.addDemo(r)},draging:function(t){if(f&&f.dragObj){!f.dragFun.hasDraging&&f.dragFun.go(t),f.dragFun.hasDraging=!0,t.cancelBubble=!0;var n=f.dragFun.pos(t,f.dragObj);e.custEvent.fire(c,"draging",n),o.outer&&f.dragFun.scroll(o.outer,n),o.demo&&f.demoFun.dragDemo(n),o.land&&f.landFun.land(n)}},end:function(t){if(f&&f.dragObj){f.dragObj.draging||f.dragFun.go(t),document.body.style.cursor="auto",document.body.onselectstart=function(){return!0},o.demo&&f.demoFun.removeDemo();var n=f.dragFun.pos(t,f.dragObj);f.dragFun.hasDraging&&e.custEvent.fire(c,"dragEnd",n),f.dragFun.hasDraging=!1,f.dragObj=null,clearTimeout(u),e.removeEvent(document,"mousemove",f.dragFun.draging),e.removeEvent(document,"mouseup",f.dragFun.end),e.removeEvent(document,"click",f.dragFun.stopClick,!0)}},scroll:function(t,o){t&&(t=e.core.dom.isNode(t)?[t]:t,e.core.arr.foreach(t,function(t,n){var r=t==document.body;if(r)f.dragFun.scrollBody(o);else{var d={t:e.core.dom.position(t).t,top:t.scrollTop,h:t.h,seeH:t.offsetHeight,fireH:20};d.top>0&&d.t+d.fireH>o.pageY?d.scrollTo=d.top-10:parseInt(d.top+d.seeH)<d.h&&d.t+d.seeH-d.fireH<o.pageY&&(d.scrollTo=d.top+10),d.scrollTo&&(t.scrollTop=d.scrollTo>0?d.scrollTo:0)}}))},scrollBody:function(t){var o={t:e.scrollPos().top,top:e.scrollPos().top,h:STK.pageSize().page.height,seeH:STK.pageSize().win.height,fireH:60};o.top>0&&o.t+o.fireH>t.pageY?o.scrollTo=o.top-10:parseInt(o.top+o.seeH)<o.h&&o.t+o.seeH-o.fireH<t.pageY&&(o.scrollTo=o.top+10),o.scrollTo&&window.scrollTo(0,o.scrollTo>0?o.scrollTo:0)},pos:function(t,o){o=o||{},o.clientX=t.clientX,o.clientY=t.clientY;var n=e.core.util.scrollPos();return o.pageX=t.clientX+n.left,o.pageY=t.clientY+n.top,o},stopClick:function(e){return e.cancelBubble=!0,!1}},landFun:{land:function(t){var o={},n=f.actDOM.length;if(!(1>=n)){for(var r=0;n>r;++r)if(f.actDOM[r]!=f.dragObj.el){var d=f.landFun.getPos(f.actDOM[r],t);(!o.pos||o.pos.len>d.len)&&(o={pos:d,dom:f.actDOM[r]})}if(o.dom!=f.dragObj.landing)if(1==o.pos.set){if(e.core.dom.next(o.dom)==f.dragObj.landing)return;f.landFun.after(o.dom,f.dragObj.landing)}else{if(e.core.dom.prev(o.dom)==f.dragObj.landing)return;f.landFun.before(o.dom,f.dragObj.landing)}}},before:function(t,o){e.core.dom.insertBefore(o,t)},after:function(t,o){e.core.dom.insertAfter(o,t)},getPos:function(t,n,r){var d,a=e.core.dom.position(t);a.endL=a.l+t.offsetWidth/2,a.endT=a.t+t.offsetHeight/2;var i=n.pageX-a.endL,l=n.pageY-a.endT;return d={len:Math.sqrt(i*i+l*l),set:(1==o.land?i:l)>0?1:2}}},demoFun:{addDemo:function(t){f.demoLay||(f.demoLay=e.C(o.spaceTag),document.body.appendChild(f.demoLay)),o.dragSelf&&e.core.dom.insertAfter(f.demoLay,f.dragObj.el);var n=e.core.dom.position(f.dragObj.el);f.dragObj.draging=o.dragSelf?f.dragObj.el:f.demoLay,f.dragObj.landing=o.dragSelf?f.demoLay:f.dragObj.el,f.demoLay.style.width=f.dragObj.el.offsetWidth+"px",f.demoLay.style.height=f.dragObj.el.offsetHeight+"px",f.demoLay.style.display="none",f.dragObj.draging.style.cssText="position:absolute;z-index:10100",f.dragObj.draging.pos={l:t.pageX-n.l,t:t.pageY-n.t},f.demoFun.setPos(t),f.setOpacity(f.dragObj.draging,80),f.setOpacity(f.dragObj.landing,50),o.demoStart?o.demoStart(f.dragObj.el,f.demoLay):(f.demoLay.style.background="#99f",f.demoLay.style.width=f.dragObj.el.offsetWidth+"px",f.demoLay.style.height=f.dragObj.el.offsetHeight+"px"),void 0!==f.dragObj.draging.setCapture&&f.dragObj.draging.setCapture()},dragDemo:function(e){f.demoLay.style.display="",f.demoFun.setPos(e),o.demoMove&&o.demoMove(f.dragObj.el,f.demoLay,e)},setPos:function(n){if(f.dragObj.draging.pos){var r=o.dragSelf?e.core.dom.position(t):{l:0,t:0},d={x:n.pageX-r.l,y:n.pageY-r.t},a=d.x-(f.dragObj.draging.pos.l||0),i=d.y-(f.dragObj.draging.pos.t||0),l=e.core.dom.getSize(t);o.containment&&(0>a?a=0:l.width<a+parseInt(f.demoLay.style.width)&&(a=l.width-parseInt(f.demoLay.style.width)),0>i?i=0:l.height+100<i+parseInt(f.demoLay.style.height)&&(i=l.height+100-parseInt(f.demoLay.style.height))),f.dragObj.draging.style.left=a+"px",f.dragObj.draging.style.top=i+"px"}},removeDemo:function(){f.dragObj&&f.dragObj.draging&&(void 0!==f.dragObj.draging.setCapture&&f.dragObj.draging.releaseCapture(),o.dragSelf&&e.core.dom.insertBefore(f.dragObj.el,f.demoLay),f.dragObj.draging.style.cssText="",f.demoLay.style.display="none",f.setOpacity(f.dragObj.landing,100),o.demoEnd&&o.demoEnd(f.dragObj.el,f.demoLay))}},setOpacity:function(t,o){e.IE?t.style.filter="alpha(opacity="+o+")":t.style.opacity=o/100}};return n=function(){if(!e.core.dom.isNode(t)||!o)throw"module.drag 需要传入外层节点对象和action-type名"},r=function(){f.DOM=e.utils.kit.dom.parseDOM(e.builder(t).list)},d=function(){"string"==typeof o&&(o={actType:o})},a=function(){e.custEvent.define(c,"dragStart"),e.custEvent.define(c,"dragEnd"),e.custEvent.define(c,"draging")},i=function(){f.objs.delegate=e.core.evt.delegatedEvent(t),f.objs.delegate.add(o.actType,"mousedown",f.DeventFun.drag),o.hasSpecialElType&&o.dragIconActionType?(f.objs.delegate.add(o.dragIconActionType,"mouseover",f.DeventFun.controlOver),f.objs.delegate.add(o.dragIconActionType,"mouseout",f.DeventFun.controlOut)):m=!1},l=function(){},g=function(){f&&(e.foreach(f.objs,function(e){e.destroy&&e.destroy()}),f=null)},s=function(){n(),r(),d(),a(),i(),l()},s(),c.destroy=g,c.demo=f.demo,c.land=f.land,c.scroll=f.scroll,c}})});