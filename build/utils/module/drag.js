steel.d("utils/kit/dom/parseDOM",[],function(e,t,o){STK.register("utils.kit.dom.parseDOM",function(e){return function(e){for(var t in e)e[t]&&1==e[t].length&&(e[t]=e[t][0]);return e}})}),steel.d("utils/kit/dom/firstChild",[],function(e,t,o){STK.register("utils.kit.dom.firstChild",function(e){var t=e.core.dom.next;return function(e){var o=e.firstChild;return o&&1!=o.nodeType&&(o=t(o)),o}})}),steel.d("utils/kit/dom/parentElementBy",[],function(e,t,o){STK.register("utils.kit.dom.parentElementBy",function(e){return function(e,t,o){if(!e||!t)throw new Error("传入的参数为空");var r,n=0;for(e=e.parentNode;e.parentNode;){if(n++,r=o(e),r===!1)return!1;if(r===!0)return e;if(r===t)return null;if(e=e.parentNode,n>3e4)return!1}return null}})}),steel.d("utils/module/drag",["utils/kit/dom/parseDOM","utils/kit/dom/firstChild","utils/kit/dom/parentElementBy"],function(e,t,o){e("utils/kit/dom/parseDOM"),e("utils/kit/dom/firstChild"),e("utils/kit/dom/parentElementBy"),STK.register("utils.module.drag",function(e){e.utils.kit.extra.language;return function(t,o){var r,n,d,a,i,l,g,s,u={};o.spaceTag=o.spaceTag?o.spaceTag:"div",o.containment=o.containment?o.containment:!1;var c={DOM:{},objs:{},DOM_eventFun:{},DeventFun:{drag:function(r){t.style.position="relative";var n=e.core.evt.getEvent();o.dragNode&&!r.el.dragDom&&(r.el.dragDom=e.utils.kit.dom.parentElementBy(r.el,t,function(e){return e.getAttribute("drag-node")?!0:void 0})),c.dragObj={dom:r.el,el:r.el.dragDom||r.el,target:n.target||e.core.evt.fixEvent().target},c.dragFun.start(n)}},land:function(e){return o.land=e?1:2,u},demo:function(e){return o.demo=!0,e?(1==e.type&&(o.dragSelf=!0),e.start&&"function"==typeof e.start&&(o.demoStart=e.start),e.move&&"function"==typeof e.move&&(o.demoMove=e.move),e.end&&"function"==typeof e.end&&(o.demoEnd=e.end),u):void 0},scroll:function(t){return t?(o.outer=e.core.dom.isNode(t)?[t]:t,e.core.arr.foreach(o.outer,function(e,t){var o=e.style.height;e.style.height="auto",e.h=e.offsetHeight,e.style.height=o}),u):void 0},dragFun:{start:function(t){return document.body.style.cursor="move",document.body.onselectstart=function(){return!1},e.addEvent(document,"mousemove",c.dragFun.draging),e.addEvent(document,"mouseup",c.dragFun.end),e.addEvent(document,"click",c.dragFun.stopClick,!0),e.IE||(t.preventDefault(),t.stopPropagation()),!1},go:function(r){c.actDOM=o.dragNode?e.sizzle("[drag-node=true]",t):e.sizzle("[action-type="+o.actType+"]",t);var n=c.dragFun.pos(r,c.dragObj);e.custEvent.fire(u,"dragStart",n),o.demo&&c.demoFun.addDemo(n)},draging:function(t){if(c&&c.dragObj){!c.dragFun.hasDraging&&c.dragFun.go(t),c.dragFun.hasDraging=!0,t.cancelBubble=!0;var r=c.dragFun.pos(t,c.dragObj);e.custEvent.fire(u,"draging",r),o.outer&&c.dragFun.scroll(o.outer,r),o.demo&&c.demoFun.dragDemo(r),o.land&&c.landFun.land(r)}},end:function(t){if(c&&c.dragObj){c.dragObj.draging||c.dragFun.go(t),document.body.style.cursor="auto",document.body.onselectstart=function(){return!0},o.demo&&c.demoFun.removeDemo();var r=c.dragFun.pos(t,c.dragObj);c.dragFun.hasDraging&&e.custEvent.fire(u,"dragEnd",r),c.dragFun.hasDraging=!1,c.dragObj=null,e.removeEvent(document,"mousemove",c.dragFun.draging),e.removeEvent(document,"mouseup",c.dragFun.end),e.removeEvent(document,"click",c.dragFun.stopClick,!0)}},scroll:function(t,o){t&&(t=e.core.dom.isNode(t)?[t]:t,e.core.arr.foreach(t,function(t,r){var n=t==document.body;if(n)c.dragFun.scrollBody(o);else{var d={t:e.core.dom.position(t).t,top:t.scrollTop,h:t.h,seeH:t.offsetHeight,fireH:20};d.top>0&&d.t+d.fireH>o.pageY?d.scrollTo=d.top-10:parseInt(d.top+d.seeH)<d.h&&d.t+d.seeH-d.fireH<o.pageY&&(d.scrollTo=d.top+10),d.scrollTo&&(t.scrollTop=d.scrollTo>0?d.scrollTo:0)}}))},scrollBody:function(t){var o={t:e.scrollPos().top,top:e.scrollPos().top,h:STK.pageSize().page.height,seeH:STK.pageSize().win.height,fireH:60};o.top>0&&o.t+o.fireH>t.pageY?o.scrollTo=o.top-10:parseInt(o.top+o.seeH)<o.h&&o.t+o.seeH-o.fireH<t.pageY&&(o.scrollTo=o.top+10),o.scrollTo&&window.scrollTo(0,o.scrollTo>0?o.scrollTo:0)},pos:function(t,o){o=o||{},o.clientX=t.clientX,o.clientY=t.clientY;var r=e.core.util.scrollPos();return o.pageX=t.clientX+r.left,o.pageY=t.clientY+r.top,o},stopClick:function(e){return e.cancelBubble=!0,!1}},landFun:{land:function(t){var o={},r=c.actDOM.length;if(!(1>=r)){for(var n=0;r>n;++n)if(c.actDOM[n]!=c.dragObj.el){var d=c.landFun.getPos(c.actDOM[n],t);(!o.pos||o.pos.len>d.len)&&(o={pos:d,dom:c.actDOM[n]})}if(o.dom!=c.dragObj.landing)if(1==o.pos.set){if(e.core.dom.next(o.dom)==c.dragObj.landing)return;c.landFun.after(o.dom,c.dragObj.landing)}else{if(e.core.dom.prev(o.dom)==c.dragObj.landing)return;c.landFun.before(o.dom,c.dragObj.landing)}}},before:function(t,o){e.core.dom.insertBefore(o,t)},after:function(t,o){e.core.dom.insertAfter(o,t)},getPos:function(t,r,n){var d,a=e.core.dom.position(t);a.endL=a.l+t.offsetWidth/2,a.endT=a.t+t.offsetHeight/2;var i=r.pageX-a.endL,l=r.pageY-a.endT;return d={len:Math.sqrt(i*i+l*l),set:(1==o.land?i:l)>0?1:2}}},demoFun:{addDemo:function(t){c.demoLay||(c.demoLay=e.C(o.spaceTag),document.body.appendChild(c.demoLay)),o.dragSelf&&e.core.dom.insertAfter(c.demoLay,c.dragObj.el);var r=e.core.dom.position(c.dragObj.el);c.dragObj.draging=o.dragSelf?c.dragObj.el:c.demoLay,c.dragObj.landing=o.dragSelf?c.demoLay:c.dragObj.el,c.demoLay.style.width=c.dragObj.el.offsetWidth+"px",c.demoLay.style.height=c.dragObj.el.offsetHeight+"px",c.demoLay.style.display="none",c.dragObj.draging.style.cssText="position:absolute;z-index:10100",c.dragObj.draging.pos={l:t.pageX-r.l,t:t.pageY-r.t},c.demoFun.setPos(t),c.setOpacity(c.dragObj.draging,80),c.setOpacity(c.dragObj.landing,50),o.demoStart?o.demoStart(c.dragObj.el,c.demoLay):(c.demoLay.style.background="#99f",c.demoLay.style.width=c.dragObj.el.offsetWidth+"px",c.demoLay.style.height=c.dragObj.el.offsetHeight+"px"),void 0!==c.dragObj.draging.setCapture&&c.dragObj.draging.setCapture()},dragDemo:function(e){c.demoLay.style.display="",c.demoFun.setPos(e),o.demoMove&&o.demoMove(c.dragObj.el,c.demoLay,e)},setPos:function(r){if(c.dragObj.draging.pos){var n=o.dragSelf?e.core.dom.position(t):{l:0,t:0},d={x:r.pageX-n.l,y:r.pageY-n.t},a=d.x-(c.dragObj.draging.pos.l||0),i=d.y-(c.dragObj.draging.pos.t||0),l=e.core.dom.getSize(t);o.containment&&(0>a?a=0:l.width<a+parseInt(c.demoLay.style.width)&&(a=l.width-parseInt(c.demoLay.style.width)),0>i?i=0:l.height+100<i+parseInt(c.demoLay.style.height)&&(i=l.height+100-parseInt(c.demoLay.style.height))),c.dragObj.draging.style.left=a+"px",c.dragObj.draging.style.top=i+"px"}},removeDemo:function(){c.dragObj&&c.dragObj.draging&&(void 0!==c.dragObj.draging.setCapture&&c.dragObj.draging.releaseCapture(),o.dragSelf&&e.core.dom.insertBefore(c.dragObj.el,c.demoLay),c.dragObj.draging.style.cssText="",c.demoLay.style.display="none",c.setOpacity(c.dragObj.landing,100),o.demoEnd&&o.demoEnd(c.dragObj.el,c.demoLay))}},setOpacity:function(t,o){e.IE?t.style.filter="alpha(opacity="+o+")":t.style.opacity=o/100}};return r=function(){if(!e.core.dom.isNode(t)||!o)throw"module.drag 需要传入外层节点对象和action-type名"},n=function(){c.DOM=e.utils.kit.dom.parseDOM(e.builder(t).list)},d=function(){"string"==typeof o&&(o={actType:o})},a=function(){e.custEvent.define(u,"dragStart"),e.custEvent.define(u,"dragEnd"),e.custEvent.define(u,"draging")},i=function(){c.objs.delegate=e.core.evt.delegatedEvent(t),c.objs.delegate.add(o.actType,"mousedown",c.DeventFun.drag)},l=function(){},g=function(){c&&(e.foreach(c.objs,function(e){e.destroy&&e.destroy()}),c=null)},s=function(){r(),n(),d(),a(),i(),l()},s(),u.destroy=g,u.demo=c.demo,u.land=c.land,u.scroll=c.scroll,u}})});