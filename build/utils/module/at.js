steel.d("utils/kit/dom/cssText",[],function(e,t,n){STK.register("utils.kit.dom.cssText",function(e){var t=function(e,t){for(var n,r=(e+";"+t).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4");r&&(n=r.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i));)r=r.replace(n[1]+n[2]+n[3],"");return r};return function(e){e=e||"";var n=[],r={push:function(e,t){return n.push(e+":"+t),r},remove:function(e){for(var t=0;t<n.length;t++)0==n[t].indexOf(e+":")&&n.splice(t,1);return r},getStyleList:function(){return n.slice()},getCss:function(){return t(e,n.join(";"))}};return r}})}),steel.d("common/listener",[],function(e,t,n){STK.register("common.listener",function(e){var t={},n={};return n.define=function(n,r){if(null!=t[n])throw"common.listener.define: 频道已被占用";t[n]=r;var i={},o=e.utils.listener;return i.register=function(e,r){if(null==t[n])throw"common.listener.define: 频道未定义";o.register(n,e,r)},i.fire=function(e,r){if(null==t[n])throw"commonlistener.define: 频道未定义";o.fire(n,e,r)},i.remove=function(e,t){o.remove(n,e,t)},i.cache=function(e){return o.cache(n,e)},i},n})}),steel.d("utils/kit/dom/isTurnoff",[],function(e,t,n){STK.register("utils.kit.dom.isTurnoff",function(e){return function(e){return!(e.parentNode&&11!=e.parentNode.nodeType&&!e.disabled)}})}),steel.d("utils/kit/extra/textareaUtils",["utils/kit/dom/isTurnoff"],function(e,t,n){e("utils/kit/dom/isTurnoff"),STK.register("utils.kit.extra.textareaUtils",function(e){var t={},n=document.selection;return t.selectionStart=function(e){if(!n)try{return e.selectionStart}catch(t){return 0}var r=n.createRange(),i=0,o=document.body.createTextRange();for(o.moveToElementText(e),i;o.compareEndPoints("StartToStart",r)<0;i++)o.moveStart("character",1);return i},t.selectionBefore=function(e){return e.value.slice(0,t.selectionStart(e))},t.selectText=function(e,t,r){if(e.focus(),!n)return void e.setSelectionRange(t,r);var i=e.createTextRange();i.collapse(1),i.moveStart("character",t),i.moveEnd("character",r-t),i.select()},t.insertText=function(e,r,i,o){if(e.focus(),o=o||0,!n){var l=e.value,s=i-o,a=s+r.length;return e.value=l.slice(0,s)+r+l.slice(i,l.length),void t.selectText(e,a,a)}var c=n.createRange();c.moveStart("character",-o),c.text=r},t.replaceText=function(e,r){e.focus();var i=e.value,o=t.getSelectedText(e),l=o.length;if(0==o.length)t.insertText(e,r,t.getCursorPos(e));else{var s=t.getCursorPos(e);if(!n){{s+o.length}return e.value=i.slice(0,s)+r+i.slice(s+l,i.length),void t.setCursor(e,s+r.length)}var a=n.createRange();a.text=r,t.setCursor(e,s+r.length)}},t.getCursorPos=function(e){var t=0;if(STK.core.util.browser.IE&&!STK.core.util.browser.IE9){!e.disabled&&e.focus();var r=null;r=n.createRange();var i=r.duplicate();i.moveToElementText(e),i.setEndPoint("EndToEnd",r),e.selectionStart=i.text.length-r.text.length,e.selectionEnd=e.selectionStart+r.text.length,t=e.selectionStart}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},t.getSelectedText=function(e){var t="",r=function(e){return void 0!=e.selectionStart&&void 0!=e.selectionEnd?e.value.substring(e.selectionStart,e.selectionEnd):""};return t=window.getSelection?r(e):n.createRange().text},t.setCursor=function(e,t,n){if(t=null==t?e.value.length:t,n=null==n?0:n,!e.disabled&&e.focus(),e.createTextRange){var r=e.createTextRange();r.move("character",t),r.moveEnd("character",n),r.select()}else e.setSelectionRange(t,t+n)},t.unCoverInsertText=function(e,t,n){n=null==n?{}:n,n.rcs=null==n.rcs?e.value.length:1*n.rcs,n.rccl=null==n.rccl?0:1*n.rccl;var r=e.value,i=r.slice(0,n.rcs),o=r.slice(n.rcs+n.rccl,""==r?0:r.length);e.value=i+t+o,this.setCursor(e,n.rcs+(null==t?0:t.length))},t})}),steel.d("utils/module/at",["utils/kit/dom/cssText","common/listener","utils/kit/extra/textareaUtils","utils/kit/dom/isTurnoff"],function(e,t,n){e("utils/kit/dom/cssText"),e("common/listener"),e("utils/kit/extra/textareaUtils"),e("utils/kit/dom/isTurnoff"),STK.register("utils.module.at",function(e){var t,n,r,i,o=(window,document),l=e.core.util.browser,s="font-family:Tahoma,宋体;",a=e.utils.kit.extra.textareaUtils.selectionStart,c=function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',s,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',s,'"> </span>'].join("")};return function(t){var n=t.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(t){return e[t]});return n}}(),u=function(){var n=[],r=t.textEl.style.cssText;return e.foreach(["margin","padding","border"],function(r){e.foreach(["Top","Left","Bottom","Right"],function(i){var o;return"border"!=r?void(o=n.push(r,"-",i.toLowerCase(),":",e.getStyle(t.textEl,r+i),";")):void e.foreach(["Color","Style","Width"],function(o){n.push(r,"-",i.toLowerCase(),"-",o.toLowerCase(),":",e.getStyle(t.textEl,[r,i,o].join("")),";")})})}),n.push("font-size:"+e.getStyle(t.textEl,"fontSize")+";"),e.utils.kit.dom.cssText([r,n.join(""),s,"\r\n			word-wrap: break-word;\r\n			line-height: 18px;\r\n			overflow-y:auto;\r\n			overflow-x:hidden;\r\n			outline:none;\r\n		"].join("")).getCss()},f=function(){var n,r,s,a=e.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,f=a.wrap[0],d=a.flag[0],v=a.after[0],g=a.before[0],h=0,x=function(e){return l.MOZ?-2:l.MOBILE&&l.SAFARI&&(l.IPAD||l.ITOUCH||l.IPHONE)?-2:0};return{bind:function(){if(r!==t.textEl){i=e.position(t.textEl);var n=["left:",i.l,"px;top:",i.t+20,"px;"].join("");r=t.textEl;var l=u();r.style.cssText=l,s=[n,l,"\r\n					position:absolute;\r\n					filter:alpha(opacity=0);\r\n					opacity:0;\r\n					z-index:-1000;\r\n				"].join(""),f.style.cssText=s,h||(h=1,o.body.appendChild(f))}},content:function(o,l,a,u){f.style.cssText=[s,"\r\n					width:",(parseInt(e.getStyle(r,"width"))||r.offsetWidth)+x(),"px;\r\n					height:",parseInt(e.getStyle(r,"height"))||r.offsetHeight,"px;\r\n					overflow-x:hidden;\r\n					overflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":e.getStyle(r,"overflowY"),";\r\n				"].join(""),g.innerHTML=c(o),d.innerHTML=c(l)||"&thinsp;",v.innerHTML=c([a,u].join("")),clearTimeout(n),n=setTimeout(function(){var n=e.position(d);e.custEvent.fire(t.eId,"at",{t:n.t-r.scrollTop-i.t,l:n.l-i.l,key:a,flag:l,textarea:t.textEl})},30)},hide:function(){f.style.display="none"},show:function(){f.style.display=""}}}(),d=function(){if(e.utils.kit.dom.isTurnoff(t.textEl))return void clearInterval(n);var i=t.textEl.value.replace(/\r/g,""),o=a(t.textEl);if(!(0>o||o==r)){r=o;var l=i.slice(0,o),s=l.match(new RegExp(["(",t.flag,")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!s)return void e.custEvent.fire(t.eId,"hidden");var c=i.slice(o);l=l.slice(0,-s[0].length),f.content(l,s[1],s[2],c)}};return function(i){if(i&&i.textEl){i=e.parseParam({textEl:null,flag:"@",eId:e.custEvent.define({},["at","hidden"])},i);var o=function(){t&&(clearInterval(n),e.removeEvent(t.textEl,"blur",o),f.hide())},l=function(){o(),t=i,r=null,f.bind(),f.show(),n=setInterval(d,200),e.addEvent(i.textEl,"blur",o)};return e.addEvent(i.textEl,"focus",l),i.eId}}})});