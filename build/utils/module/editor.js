steel.d("utils/kit/dom/parseDOM",[],function(t,e,r){STK.register("utils.kit.dom.parseDOM",function(t){return function(t){for(var e in t)t[e]&&1==t[e].length&&(t[e]=t[e][0]);return t}})}),steel.d("utils/kit/dom/isTurnoff",[],function(t,e,r){STK.register("utils.kit.dom.isTurnoff",function(t){return function(t){return!(t.parentNode&&11!=t.parentNode.nodeType&&!t.disabled)}})}),steel.d("utils/kit/extra/textareaUtils",["utils/kit/dom/isTurnoff"],function(t,e,r){t("utils/kit/dom/isTurnoff"),STK.register("utils.kit.extra.textareaUtils",function(t){var e={},r=document.selection;return e.selectionStart=function(t){if(!r)try{return t.selectionStart}catch(e){return 0}var n=r.createRange(),o=0,i=document.body.createTextRange();for(i.moveToElementText(t),o;i.compareEndPoints("StartToStart",n)<0;o++)i.moveStart("character",1);return o},e.selectionBefore=function(t){return t.value.slice(0,e.selectionStart(t))},e.selectText=function(t,e,n){if(t.focus(),!r)return void t.setSelectionRange(e,n);var o=t.createTextRange();o.collapse(1),o.moveStart("character",e),o.moveEnd("character",n-e),o.select()},e.insertText=function(t,n,o,i){if(t.focus(),i=i||0,!r){var l=t.value,u=o-i,s=u+n.length;return t.value=l.slice(0,u)+n+l.slice(o,l.length),void e.selectText(t,s,s)}var c=r.createRange();c.moveStart("character",-i),c.text=n},e.replaceText=function(t,n){t.focus();var o=t.value,i=e.getSelectedText(t),l=i.length;if(0==i.length)e.insertText(t,n,e.getCursorPos(t));else{var u=e.getCursorPos(t);if(!r){{u+i.length}return t.value=o.slice(0,u)+n+o.slice(u+l,o.length),void e.setCursor(t,u+n.length)}var s=r.createRange();s.text=n,e.setCursor(t,u+n.length)}},e.getCursorPos=function(t){var e=0;if(STK.core.util.browser.IE&&!STK.core.util.browser.IE9){!t.disabled&&t.focus();var n=null;n=r.createRange();var o=n.duplicate();o.moveToElementText(t),o.setEndPoint("EndToEnd",n),t.selectionStart=o.text.length-n.text.length,t.selectionEnd=t.selectionStart+n.text.length,e=t.selectionStart}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e},e.getSelectedText=function(t){var e="",n=function(t){return void 0!=t.selectionStart&&void 0!=t.selectionEnd?t.value.substring(t.selectionStart,t.selectionEnd):""};return e=window.getSelection?n(t):r.createRange().text},e.setCursor=function(t,e,r){if(e=null==e?t.value.length:e,r=null==r?0:r,!t.disabled&&t.focus(),t.createTextRange){var n=t.createTextRange();n.move("character",e),n.moveEnd("character",r),n.select()}else t.setSelectionRange(e,e+r)},e.unCoverInsertText=function(t,e,r){r=null==r?{}:r,r.rcs=null==r.rcs?t.value.length:1*r.rcs,r.rccl=null==r.rccl?0:1*r.rccl;var n=t.value,o=n.slice(0,r.rcs),i=n.slice(r.rcs+r.rccl,""==n?0:n.length);t.value=o+e+i,this.setCursor(t,r.rcs+(null==e?0:e.length))},e})}),steel.d("utils/kit/extra/count",[],function(t,e,r){STK.register("utils.kit.extra.count",function(t){function e(e){for(var r=41,n=140,o=20,i=e,l=e.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],u=0,s=0,c=l.length;c>s;s++){var a=t.core.str.bLength(l[s]);/^(http:\/\/t.cn)/.test(l[s])||(u+=(/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(l[s])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(l[s]))&&r>=a?a:n>=a?o:a-n+o,i=i.replace(l[s],""))}var d=Math.ceil((u+t.core.str.bLength(i))/2);return d}return function(t){return t=t.replace(/\r\n/g,"\n"),num=e(t)}})}),steel.d("utils/module/editor",["utils/kit/dom/parseDOM","utils/kit/extra/textareaUtils","utils/kit/extra/count"],function(t,e,r){t("utils/kit/dom/parseDOM"),t("utils/kit/extra/textareaUtils"),t("utils/kit/extra/count"),STK.register("utils.module.editor",function(t){t.core.evt.addEvent,t.core.evt.custEvent,t.core.dom.getStyle,t.core.dom.setStyle;return function(e,r){var n={},r=r,o={},i={reset:function(){o.textEl.value="",t.core.evt.custEvent.fire(n,"changed"),o.textEl.removeAttribute("extra")},delWords:function(t){var e=i.getWords();return e.indexOf(t)>-1?(o.textEl.value="",void u.textInput(e.replace(t,""))):!1},getWords:function(){return t.core.str.trim(o.textEl.value)},getExtra:function(){var e,r=o.textEl.getAttribute("extra")||"";return null!=r&&(e=t.core.str.trim(r)),e},focus:function(e,r){if("undefined"!=typeof e)t.utils.kit.extra.textareaUtils.setCursor(o.textEl,e,r);else{var n=t.utils.kit.extra.textareaUtils.getSelectedText(o.textEl);if(!n||0==n.length){var i=o.textEl.value.length;t.utils.kit.extra.textareaUtils.setCursor(o.textEl,i)}}l.cacheCurPos()},blur:function(){o.textEl.blur()},addExtraInfo:function(t){"string"==typeof t&&o.textEl.setAttribute("extra",t)},disableEditor:function(e){t.core.evt.removeEvent(o.textEl,"mouseup",l.cacheCurPos),e===!0?o.textEl.setAttribute("disabled","disabled"):(t.core.evt.addEvent(o.textEl,"mouseup",l.cacheCurPos),o.textEl.removeAttribute("disabled"))},getCurPos:function(){var t=o.textEl.getAttribute("range")||"0&0";return t.split("&")},count:function(){var e=0==t.core.str.trim(o.textEl.value).length?t.core.str.trim(o.textEl.value):o.textEl.value;return t.utils.kit.extra.count(e)}},l={textElFocus:function(){o.recommendTopic&&t.core.dom.setStyle(o.recommendTopic,"display","none"),t.custEvent.fire(n,"focus"),o.num&&t.core.dom.setStyle(o.num,"display","block"),i.getWords()==r.tipText&&i.delWords(r.tipText)},textElBlur:function(){setTimeout(function(){0===o.textEl.value.length&&(o.recommendTopic&&t.core.dom.setStyle(o.recommendTopic,"display","block"),o.num&&o.recommendTopic&&t.core.dom.setStyle(o.num,"display","none"),t.custEvent.fire(n,"blur"),"undefined"!=typeof r.tipText&&(o.textEl.value=r.tipText))},50)},cacheCurPos:function(){var e=t.utils.kit.extra.textareaUtils.getSelectedText(o.textEl),r=""==e||null==e?0:e.length,n=t.utils.kit.extra.textareaUtils.getCursorPos(o.textEl),i=n+"&"+r;o.textEl.setAttribute("range",i)}},u={textChanged:function(){t.custEvent.fire(n,"keyUpCount")},textInput:function(e,u){{var s=i.getCurPos(),u=s[0];s[1]}t.log("module.editor.sssssssssssss = "+u),i.getWords()==r.tipText&&e!=r.tipText&&i.delWords(r.tipText),t.utils.kit.extra.textareaUtils.unCoverInsertText(o.textEl,e,{rcs:s[0],rccl:s[1]}),l.cacheCurPos(),t.core.evt.custEvent.fire(n,"changed")}},s=function(){d(),x()},c=function(){f(),g(),E(),a()},a=function(){return r.storeWords?void(0==o.textEl.value.length&&u.textInput(r.storeWords)):void(r.tipText&&(o.textEl.value=r.tipText))},d=function(){if(!e)throw"node is not defined in module editor"},x=function(){var r=t.core.dom.builder(e).list;if(o=t.utils.kit.dom.parseDOM(r),!o.widget)throw"can not find nodes.widget in module editor"},f=function(){t.core.evt.addEvent(o.textEl,"focus",l.textElFocus),t.core.evt.addEvent(o.textEl,"blur",l.textElBlur),t.core.evt.addEvent(o.textEl,"mouseup",l.cacheCurPos),t.core.evt.addEvent(o.textEl,"keyup",l.cacheCurPos)},v=function(){t.core.evt.custEvent.define(n,"changed")},g=function(){v(),t.core.evt.custEvent.add(n,"changed",u.textChanged)},E=function(){},m=function(){};s();var h={reset:i.reset,getWords:i.getWords,getExtra:i.getExtra,delWords:i.delWords,focus:i.focus,blur:i.blur,insertText:u.textInput,check:u.textChanged,addExtraInfo:i.addExtraInfo,disableEditor:i.disableEditor,getCurPos:i.getCurPos,count:i.count,textElFocus:l.textElFocus};return n.destroy=m,n.API=h,n.nodeList=o,n.init=c,n.opts=r,n}})});