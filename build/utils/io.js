steel.d("utils/module/layer",[],function(e,t,n){STK.register("utils.module.layer",function(e){var t=function(e){var t={};return"none"==e.style.display?(e.style.visibility="hidden",e.style.display="",t.w=e.offsetWidth,t.h=e.offsetHeight,e.style.display="none",e.style.visibility="visible"):(t.w=e.offsetWidth,t.h=e.offsetHeight),t},n=function(n,o){o=o||"topleft";var i=null;if("none"==n.style.display?(n.style.visibility="hidden",n.style.display="",i=e.core.dom.position(n),n.style.display="none",n.style.visibility="visible"):i=e.core.dom.position(n),"topleft"!==o){var r=t(n);"topright"===o?i.l=i.l+r.w:"bottomleft"===o?i.t=i.t+r.h:"bottomright"===o&&(i.l=i.l+r.w,i.t=i.t+r.h)}return i};return function(o){var i=e.core.dom.builder(o),r=i.list.outer[0],u=i.list.inner[0],s=e.core.dom.uniqueID(r),l={},a=e.core.evt.custEvent.define(l,"show");e.core.evt.custEvent.define(a,"hide");var d=null;return l.show=function(){return r.style.display="",e.core.evt.custEvent.fire(a,"show"),l},l.hide=function(){return r.style.display="none",e.custEvent.fire(a,"hide"),l},l.getPosition=function(e){return n(r,e)},l.getSize=function(e){return(e||!d)&&(d=t.apply(l,[r])),d},l.html=function(e){return void 0!==e&&(u.innerHTML=e),u.innerHTML},l.text=function(t){return void 0!==text&&(u.innerHTML=e.core.str.encodeHTML(t)),e.core.str.decodeHTML(u.innerHTML)},l.appendChild=function(e){return u.appendChild(e),l},l.getUniqueID=function(){return s},l.getOuter=function(){return r},l.getInner=function(){return u},l.getParentNode=function(){return r.parentNode},l.getDomList=function(){return i.list},l.getDomListByKey=function(e){return i.list[e]},l.getDom=function(e,t){return i.list[e]?i.list[e][t||0]:!1},l.getCascadeDom=function(t,n){return i.list[t]?e.core.dom.cascadeNode(i.list[t][n||0]):!1},l}})}),steel.d("utils/kit/dom/layoutPos",[],function(e,t,n){STK.register("utils.kit.dom.layoutPos",function(e){return function(t,n,o){if(!e.isNode(n))throw"kit.dom.layerOutElement need element as first parameter";if(n===document.body)return!1;if(!n.parentNode)return!1;if("none"===n.style.display)return!1;var i,r,u,s,l,a,d;if(i=e.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},o),r=n,!r)return!1;for(;r!==document.body;){if(r=r.parentNode,"none"===r.style.display)return!1;if(a=e.getStyle(r,"position"),d=r.getAttribute("layout-shell"),"absolute"===a||"fixed"===a)break;if("true"===d&&"relative"===a)break}return r.appendChild(t),u=e.position(n,{parent:r}),s={w:n.offsetWidth,h:n.offsetHeight},l=i.pos.split("-"),"left"===l[0]?t.style.left=u.l+i.offsetX+"px":"right"===l[0]?t.style.left=u.l+s.w+i.offsetX+"px":"center"===l[0]&&(t.style.left=u.l+s.w/2+i.offsetX+"px"),"top"===l[1]?t.style.top=u.t+i.offsetY+"px":"bottom"===l[1]?t.style.top=u.t+s.h+i.offsetY+"px":"middle"===l[1]&&(t.style.top=u.t+s.h/2+i.offsetY+"px"),!0}})}),steel.d("utils/module/bubble",["utils/module/layer","utils/kit/dom/layoutPos"],function(e,t,n){e("utils/module/layer"),e("utils/kit/dom/layoutPos"),STK.register("utils.module.bubble",function(e){return function(t,n){if(!t)throw"module.bubble need template as first parameter";var o,i,r,u,s,l,a;i=e.parseParam({width:null,height:null,parent:document.body},n),r=e.utils.module.layer(t),u=r.getDom("outer"),s=r.getDom("inner"),r.getDomListByKey("close")&&(l=r.getDom("close")),u.style.display="none",a=!1;var d=function(t){if(a)return!0;var n=e.fixEvent(t);e.contains(u,n.target)||r.hide()};return l&&e.addEvent(l,"click",r.hide),e.custEvent.add(r,"show",function(){setTimeout(function(){e.addEvent(document.body,"click",d)},0)}),e.custEvent.add(r,"hide",function(){a=!1,e.removeEvent(document.body,"click",d)}),o=r,o.setPosition=function(e){return u.style.top=e.t+"px",u.style.left=e.l+"px",o},o.setLayout=function(t,n){if(!e.isNode(t))throw"module.bubble.setDown need element as first parameter";return e.utils.kit.dom.layoutPos(u,t,n),o},o.setContent=function(t){return"string"==typeof t?s.innerHTML=t:e.isNode(t)&&s.appendChild(t),o},o.setArrow=function(e){var t;r.getDomListByKey("arrow")&&(t=r.getDom("arrow"),t.className=e.className||"",t.style.cssText=e.style||"")},o.clearContent=function(){for(;s.children.length;)e.removeNode(s.children[0])},o.stopBoxClose=function(){a=!0},o.startBoxClose=function(){a=!1},o.destroy=function(){e.removeEvent(document.body,"click",d),r=null,u=null,s=null,l=null},o}})}),steel.d("ui/bubble",["utils/module/bubble"],function(e,t,n){e("utils/module/bubble"),STK.register("ui.bubble",function(e){var t='<div class="W_layer W_layer_pop" node-type="outer"><div class="content"><div class="W_layer_close"><a class="W_ficon ficon_close S_ficon" href="javascript:void(0);" node-type="close" title="关闭">X</a></div><div node-type="inner"></div><div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_t" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',n=[],o=function(o){var u=e.utils.module.bubble(t,o);return e.custEvent.add(u,"hide",function(){r(u),i(u)}),n.push({bub:u,used:!0}),u},i=function(e){e.clearContent(),document.body.appendChild(e.getOuter())},r=function(e){for(var t=0,o=n.length;o>t;t+=1)if(e===n[t].bub)return void(n[t].used=!1)},u=function(e){for(var t,i=0,r=n.length;r>i;i+=1)if(!n[i].used)return n[i].used=!0,t=n[i].bub;return t=o(e)};return function(t){return u(e.parseParam({},t))}})}),steel.d("utils/io",["ui/bubble"],function(e,t,n){e("ui/bubble"),STK.register("utils.io",function(e){return function(){function t(){if(i.length&&r!==!0){r=!0;var t=i.shift(),n=t[1];n.data=t[0],n.ajLock=!0,n.aj=e.ajax(n)}}var n={},o={},i=[],r=!1;return n.register=function(t,n){if(void 0!==o[t])throw t+" interface has been registered";o[t]=e.merge({ajLock:!1,timeout:3e4,dataType:"json"},n),o[t].type=o[t].method},n.getTrans=function(n,u){if(!o[n])throw n+" interface has not been registered";var s=o[n],l=s;return u=e.parseParam({onComplete:e.empty,onSuccess:e.empty,onError:function(t){e.ui.bubble(t&&t.msg||"请求错误")},onFail:function(t){e.ui.bubble("服务器错误")}},u),s.onComplete=function(e,n){r=!1,l.ajLock=!1;try{u.onComplete(e,n)}catch(o){throw"[Error]onComplete: "+o}if(1e5==e.code)try{u.onSuccess(e,n)}catch(o){throw o}else try{100002==e.code&&(window.location.href=e.data),u.onError(e,n)}catch(o){throw"[Error]onError: "+o}setTimeout(t,0)},s.onTimeout=s.onFail=function(e,n){r=!1,l.ajLock=!1;var o={msg:"服务器错误"};u.onFail(o,n),setTimeout(t,0)},s.request=function(){return function(e){l.ajLock||(e=e||{},e.superuid||window.$CONFIG&&$CONFIG.superuid&&(e.superuid=$CONFIG.superuid),i.push([e,l]),t())}}(),s.abort=function(){return function(e){if(r=!1,l.aj)try{l.aj.abort()}catch(t){throw"[Error]trans abort:"+t}l.aj=null,l.ajLock=!1}}(),s},n}})});